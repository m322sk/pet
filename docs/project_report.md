Введение
Тинькофф Black предоставляет клиентам повышенный кэшбэк: каждый месяц можно выбрать несколько категорий покупок, по которым будет повышенный процент возврата средств (обычно 5% против базового 1%)[1]. В данном проекте проанализированы агрегированные данные по транзакциям и кэшбэку клиентов Tinkoff Black за период с апреля по сентябрь 2023 года[2]. Цель анализа – продемонстрировать навыки продуктовой аналитики: подготовка данных, расчет ключевых метрик использования карточного продукта, проверка гипотез о поведении пользователей и формулирование бизнес-рекомендаций.
Этот отчёт структурирован в формате, удобном для размещения в репозитории (например, README.md). В следующих разделах описаны используемый стек технологий, характеристики датасета, этапы очистки и трансформации, основные продуктовые метрики, результаты проверки гипотезы, а также выводы и рекомендации для бизнеса. В завершение приведена схема архитектуры пайплайна данных, отражающая процесс интеграции и визуализации данных.
Стек технологий
Проект выполнен с использованием следующих инструментов и технологий:
•	PostgreSQL – для хранения данных на этапах staging, формировании факт-таблиц и витрин метрик с помощью SQL. Все исходные данные были загружены в БД и обработаны SQL-скриптами.
•	Python – для дополнительной обработки данных и аналитических вычислений. Библиотеки Pandas и matplotlib использовались для расчета метрик, проведения статистических тестов (t-test) и построения графиков.
•	DBeaver – как клиент к базе данных PostgreSQL, для исследования данных, написания и отладки SQL-запросов (например, скриптов очистки postgres_02_cleaning.sql и расчёта метрик postgres_03_metrics.sql).
•	BI-платформа (Apache Superset) – для визуализации итоговых метрик и построения интерактивных дашбордов. Подготовленные витрины данных в PostgreSQL подключены к Superset, что позволило создать графики по метрикам (MAU, средний чек, распределение оборота и др.) и отслеживать их динамику.
•	Планировщик (cron/Airflow) – для оркестрации обновления данных. Настроены задачи, которые по расписанию загружают новые файлы в staging-таблицы, запускают SQL-трансформации и обновляют витрины в BI. Также реализованы алерты мониторинга качества данных (проверки на пропуски, дубли) с отправкой отчётов, например, в Telegram.
Описание данных
Датасет представляет собой помесячную агрегированную информацию по клиентам Tinkoff Black, включающую оборот (сумму покупок) по категориям, факты активации повышенного кэшбэка и начисленный кэшбэк. Каждая запись соответствует уникальному клиенту в конкретном месяце. Данные охватывают 6 месяцев (апрель – сентябрь 2023 г.)[2]. Всего в выборке 9 971 уникальный клиент; каждый из них присутствует в каждом месяце (итого ~59,8 тыс. записей “клиент-месяц”), что позволяет отслеживать динамику поведения одних и тех же пользователей.
Полях датасета: В таблице представлены следующие группы полей:
•	Идентификаторы и демография: уникальный ключ_клиента, регион и город проживания, возраст и пол.
•	Месяц: поле месяц_покупок (тип Date) указывает календарный месяц, за который агрегированы показатели.
•	Обороты по категориям: 17 полей вида оборот_<категория> – сумма транзакций клиента за месяц в конкретной товарной категории (например, аптеки, рестораны, одежда, супермаркеты и т.д.). Если клиент в данном месяце не совершал покупок в категории, значение стоит 0 (в данных хранится как NULL, если категория ему не предлагалась вовсе).
•	Активация категорий кэшбэка: 17 полей активация_кэшбэка_<категория>, показывающих, была ли данная категория предложена клиенту для повышенного кэшбэка и выбрал ли он её. Возможные значения – 1 (категория была в списке и выбрана клиентом), 0 (категория была предложена, но клиент её не выбрал) или NULL (данная категория не предлагалась клиенту в этом месяце)[3]. Например, если у клиента активация_кэшбэка_такси = 0, это значит, что в том месяце категория “такси” была среди вариантов, но клиент её не выбрал для повышенного кэшбэка; активация_кэшбэка_супермаркеты = 1 означает, что клиент выбрал категорию “супермаркеты” для повышенного кэшбэка, а активация_кэшбэка_фастфуд = NULL – категория “фастфуд” не была доступна клиенту для выбора.
•	Начисленный кэшбэк: 17 полей кэшбэк_<категория> – сумма cashback, полученного клиентом за месяц по каждой категории. В случае выбора категории (повышенный кэшбэк ~5%) здесь отражена сумма возврата; если категория не была выбрана, но траты по ней были, в этих полях, как правило, стоит 0 (базовый кэшбэк 1% на все покупки вне выбранных категорий в данной таблице явно не указан, либо включён в суммы для выбранных категорий).
Особенности данных: Клиентам Tinkoff Black без платной подписки Tinkoff PRO ежемесячно предлагается выбрать 3 категории из списка (обычно из 7 доступных вариантов) для повышенного кэшбэка. Если у клиента подключена подписка, ему доступно больше категорий (8 вариантов) и, возможно, больше выбираемых категорий. В имеющемся датасете признак наличия подписки можно отследить по числу доступных категорий: например, если в поле активаций у клиента в месяце отмечено 8 различных категорий (значениями 0 или 1, не считая пропусков), то это служит прокси того, что у клиента была подписка на Tinkoff PRO в данном месяце. В выборке очень немногие клиенты имели 8 доступных категорий (порядка 3 наблюдений в апреле), что говорит о том, что подавляющее большинство – пользователи без подписки (им предлагалось ≤7 категорий, чаще 4–6). Это стоит учитывать при анализе гипотезы. Кроме того, данные представляют не сырые транзакции, а их месячную агрегaцию по категориям, поэтому метрики рассчитаны на основании уже сгруппированных значений.
Очистка и нормализация данных
Перед расчётом метрик данные были приведены к удобному виду:
•	Очистка пропусков и типов: Текстовые пометки пропусков категорий (“пропуск”) преобразованы в NULL. Поля активации приведены к числовому типу (INTEGER 0/1). Отсутствующие значения оборота и кэшбэка по неактивным категориям заменены на 0 для корректного агрегирования. Также проверена целостность: в суммарном обороте по всем категориям для каждой записи не было аномалий (например, отрицательных значений).
•	Нормализация структуры: Исходная широкая структура (колонки на каждую категорию) была трансформирована в более удобный длинный формат. Построена факт-таблица fact_cashback_category в PostgreSQL, где каждая строка соответствует одной категории одного клиента в одном месяце (с указанием оборота, флага активации и суммы кэшбэка по этой категории). Такой подход упростил расчёт сводных метрик SQL-запросами (через группировки и фильтрацию по категориям). Дополнительно сформирована агрегированная витрина mart_client_month – показатели на уровне “клиент-месяц” (общий оборот, суммарный кэшбэк, количество выбранных категорий и др.), которая облегчает построение дашбордов и расчет метрик вовлеченности.
•	Склейка с данными о подписке: Поскольку прямая информация о наличии подписки (Tinkoff PRO) отсутствует в исходном датасете транзакций, был использован подход с прокси-переменной – вычислено количество предложенных категорий у каждого клиента по месяцам. Клиентам, у которых когда-либо было 8 доступных категорий, присвоен признак has_subscription=1. В дальнейшем для проверки гипотезы мы разбили пользователей на группы с подпиской (test) и без (control) на основании этого признака. (Примечание: также рассматривались дополнительные данные о подписке из внутренних источников, однако для целостности проекта было решено ограничиться информацией, содержащейся в основном датасете.)
После этих шагов данные были готовы для вычисления основных метрик. Все трансформации осуществлялись с помощью SQL-скриптов в PostgreSQL (см. postgres_02_cleaning.sql), а результат выгружен для анализа в Python.
Основные метрики продукта
На подготовленных данных рассчитан ряд ключевых метрик, характеризующих использование карточного продукта Tinkoff Black за рассматриваемый период.
•	MAU (Monthly Active Users) – количество активных пользователей в месяц. В данном случае активным считается клиент, совершивший хотя бы одну покупку в месяце (фактически все клиенты, представленные в выборке, активны ежемесячно). Поскольку выборка содержит фиксированный пул из 9 971 клиента, MAU по месяцам стабильны и равны 9 971 для каждого месяца с апреля по сентябрь. Это означает, что оттока пользователей в рамках выборки не наблюдается (каждый клиент совершал операции каждый месяц) – вероятно, данные изначально отобраны по критерию активности за весь период. Для наглядности MAU можно было бы изобразить линейным графиком по месяцам, но в нашем случае это просто прямая линия на уровне ~10k.
•	Средний оборот на клиента в месяц – средняя сумма расходов на одного активного клиента. Рассчитана как суммарный оборот всех клиентов за месяц, делённый на MAU того месяца. По нашим данным, средний месячный оборот на клиента составлял ~352 тыс. руб. в апреле 2023, постепенно рос и достиг пика ~389 тыс. руб. в июле, затем в сентябре опустился до ~363 тыс. руб. Например, в июле совокупные траты всех пользователей были ~3,88 млрд руб., что при 9 971 пользователе дало в среднем ~389k на человека. Рост среднего чека летом может отражать сезонный всплеск расходов (отпускной период, траты на отдых). В целом диапазон среднего оборота – 350–390 тысяч рублей в месяц, что достаточно высокий показатель, свидетельствующий о том, что в выборке представлены активные и платёжеспособные клиенты.
•	Средний полученный кэшбэк на клиента – средняя сумма cashback, полученного одним клиентом за месяц. В абсолютных цифрах наблюдается рост от ~3 443 руб. в апреле до ~5 212 руб. в сентябре на одного клиента в месяц. Максимум пришёлся на сентябрь, когда средний cashback заметно вырос относительно предыдущего месяца (в августе ~4 284 руб.). Рост средней суммы cashback при снижении среднего оборота в сентябре говорит о том, что к концу периода клиенты стали получать больший процент возврата от трат. Действительно, отношение суммарного кэшбэка к суммарному обороту увеличилось с ~0,98% в апреле до ~1,43% в сентябре. Это может объясняться, например, акциями с повышенным процентом в отдельных категориях в конце периода или тем, что всё больше клиентов оптимально выбирали категории с повышенным кэшбэком под свои траты. В среднем за 6 месяцев эффективный процент кэшбэка составил ~1,15% от суммы расходов (то есть пользователи в среднем возвращали ~1,15 рубля с каждых 100 рублей покупки, включая базовый и повышенный кэшбэк).
•	Доля клиентов, активировавших категории (choose rate) – процент пользователей, выбравших хотя бы одну категорию повышенного кэшбэка в каждом месяце. Этот показатель характеризует вовлечённость аудитории в продуктовую фичу (выбор категорий для максимизации выгоды). В начале периода наблюдается небольшой лаг: в апреле 97,1% клиентов выбрали хотя бы одну категорию, тогда как ~2,9% (≈ 288 человек) не сделали выбор. Уже в мае показатель вырос до 98,8%, и в оставшиеся месяцы стабильно держался на уровне ~99%. Практически все активные пользователи регулярно пользуются возможностью выбора категорий. Небольшое улучшение с апреля на май может указывать на эффект обучения новых клиентов: возможно, часть аудитории в апреле ещё не успела разобраться с функциональностью или присоединилась в середине месяца, поэтому не выбрала категории, но в последующие месяцы таких случаев почти не осталось. Для продукта это хороший знак – фича востребована подавляющим большинством пользователей.
•	Распределение оборота по категориям – показывает, на какие категории приходится наибольшая доля расходов пользователей. На графике ниже видно распределение совокупного оборота всех клиентов за 6 месяцев по категориям:
 
Распределение оборота по категориям с апреля по сентябрь 2023 г. (суммарно). Показаны категории в порядке убывания доли в общем объёме трат.
Из диаграммы очевидно доминирование повседневных категорий: «Супермаркеты» существенно опережают другие и составляют около 28% общего оборота. Это ожидаемо, так как покупки продуктов – регулярная и крупная статья расходов. На втором месте – «Одежда и обувь» (~13%), далее «Рестораны» (~10,5%), «Дом и ремонт» (~9,9%) и «Фастфуд» (~9,7%). Крупные доли также у автоуслуг (~7,9%) – вероятно, включают топливо и сервис, что для части пользователей значимые траты. Остальные категории имеют меньший вклад: такси (~4,4%), развлечения (~3,9%), аптеки (~2,7%), образование (~2,3%) и т.д. Самую небольшую долю занимают каршеринг (~0,6%) и аренда авто (~0,1%) – эти услуги специфичны и доступны не всем, поэтому ожидаемо невелики по объёму. Данное распределение полезно с продуктовой точки зрения: оно подсказывает, какие категории наиболее значимы для клиентов. Например, имеет смысл почти всегда предлагать «Супермаркеты» среди вариантов повышенного кэшбэка, так как траты на них есть у большинства и на большие суммы. Напротив, категории из “длинного хвоста” (типа аренды авто) влияют на меньшинство пользователей и дают небольшой прирост кэшбэка, возможно их можно ротировать реже или заменить более популярными сегментами.
Гипотеза: влияние наличия 8 категорий (подписки) на поведение
Формулировка гипотезы: Пользователи, которым доступно 8 категорий для выбора (то есть с подпиской Tinkoff PRO), демонстрируют иную структуру расходов по сравнению с остальными. В частности, предполагалось, что наличие расширенного набора категорий приводит к тому, что большая доля расходов этих пользователей приходится на выбранные ими категории (т.к. они либо могут выбрать больше категорий одновременно, либо имеют более подходящие варианты под свои траты). Иными словами, подписчики активнее оптимизируют свои расходы под повышенный кэшбэк.
Метод проверки: В силу ограничений данных, прямой A/B-тест невозможен – мы не имеем случайно разделённых групп, а лишь наблюдаем существующие различия (observational approach). Поэтому мы разделили исторические данные на две группы:
•	Control: пользователи без подписки (в нашем датасете – те, у кого никогда не было 8 доступных категорий в месяце). Таких – 9 968 человек.
•	Test: пользователи с признаками подписки (те, у кого хотя бы в одном месяце было 8 категорий на выбор). Таких нашлось всего 3 человека в апреле 2023. (Примечание: малый размер группы – ограничение выборки; в реальности доля подписчиков могла быть больше.)
В качестве целевой метрики взяли долю оборота в выбранных категориях для каждого клиента. Для каждого пользователя рассчитана величина: сумма его расходов по тем категориям, которые он выбрал для повышенного кэшбэка, делённая на общий оборот пользователя. Чем выше эта доля, тем больше клиент концентрирует траты в “выбранных” категориях (то есть максимизирует возврат). Мы сравнили средние значения этой метрики между двумя группами за весь период. Статистическая проверка выполнена с помощью двухвыборочного t-теста (Welch’s t-test) для независимых групп, несмотря на весьма неравные размеры выборок.
Результаты: Пользователи с подпиской действительно показывают большую долю расходов в выбранных категориях: около 52,2% их трат приходится на категории с повышенным кэшбэком, в то время как у пользователей без подписки – лишь ~25,2%. Иначе говоря, в нашей выборке “подписчики” направляли на выбранные категории примерно половину своих средств, тогда как остальные – только четверть. Разница (uplift) составляет порядка +107% относительно контрольной группы. Однако, статистический тест не подтвердил значимость этого отличия на обычном уровне уверенности 95%. Расчётный критерий t = 1,53 при приблизительно 2 степенях свободы (из-за крайне малого размера test-группы) даёт p-value ~0,13, что выше порога 0,05. Таким образом, мы не отвергаем нулевую гипотезу о равенстве средних – формально влияние подписки на долю оборота в выбранных категориях не доказано.
Тем не менее, практически столь большая разница выглядит содержательно важной. Скорее всего, причина статистической незначимости – недостаток данных о подписчиках: всего 3 наблюдения явно недостаточно для выявления эффекта. Можно сделать осторожный вывод, что пользователи с подпиской действительно стараются извлечь больше выгоды: имея больше категорий на выбор (и, возможно, возможность выбрать больше категорий одновременно), они охватывают повышенным кэшбэком больший процент своих расходов. Косвенно это подтверждается тем, что один из подписчиков из выборки сумел получить повышенный кэшбэк почти со всей суммы трат (его показатель ~85%). Также нельзя исключить эффект самоселекции: подписку оформляют, вероятно, самые лояльные и финансово активные клиенты, которые изначально склонны оптимизировать расходы. Таким образом, выявленный uplift в ~27 процентных пунктов (52% vs 25%) в доле “осмысленных” трат – ценное наблюдение, но для уверенности необходимы дополнительные данные или эксперимент.
Вывод по гипотезе: хотя статистически значимых доказательств нет, данные указывают на то, что расширение числа категорий (продуктовое преимущество подписки) связано с более высоким вовлечением в использование карточных бонусов. Это потенциально ценно для бизнеса: подписчики могут генерировать больший оборот по картам в тех категориях, где банк предоставляет кэшбэк, что может означать более частое использование карты и рост транзакционной активности.
Выводы и рекомендации
В ходе проекта были рассчитаны ключевые показатели использования дебетовой карты Tinkoff Black с функциональностью повышенного кэшбэка и проанализировано влияние подписки Tinkoff PRO на поведение клиентов. Ниже суммируем основные инсайты и предлагаем рекомендации:
•	Высокая вовлеченность в программу категорий кэшбэка. Практически все клиенты (≈99%) регулярно выбирают категории с повышенным кэшбэком каждый месяц. Это говорит о востребованности данной функции – клиенты ценят возможность получать повышенный процент возврата и осведомлены о необходимости выбора категорий. Рекомендация: продолжать развивать функциональность категорий, своевременно информировать новых клиентов о необходимости выбирать категории (например, через push-уведомления или подсказки в приложении, особенно в первый месяц использования, когда ~2-3% могли пропустить выбор). Повышение choose rate с 97% до 99% уже произошло естественным образом, но максимизация до 100% (полное устранение случаев невыбора) принесёт пользу и клиентам, и банку в виде повышения лояльности.
•	Структура расходов по категориям соответствует ожиданиям, но есть концентрация на нескольких ключевых сегментах. Более половины всех трат приходится всего на 5 категорий (супермаркеты, одежда, рестораны, дом/ремонт, фастфуд). Наиболее популярные категории, такие как супермаркеты, имеют и наибольший эффект на начисляемый кэшбэк. Рекомендация: включать самые массовые категории в список предложений для кэшбэка как можно чаще. Вероятно, эти категории уже присутствуют ежемесячно (что логично, учитывая их популярность). Для менее популярных категорий имеет смысл пересмотреть частоту их появления: например, “аренда авто” приносит мизерный объём оборота – возможно, её можно заменять на более актуальные категории либо предлагать адресно тем клиентам, у которых замечены траты в этой области (персонализация). Это позволит повысить ценность категории выбора для каждого клиента.
•	Средний объём трат и кэшбэка на клиента велик, эффективный процент ~1,1–1,4%. Клиенты из выборки тратят в среднем ~350–380 тыс. руб. в месяц и получают ~4–5 тыс. руб. кэшбэка. Доля возврата близка к максимально возможной (~1% базовый на все + бонусы на часть трат). Это говорит о том, что пользователи активно используют карту для разнообразных покупок. Рекомендация: можно рассмотреть увеличение лимитов или процента кэшбэка по наиболее важным категориям для топ-сегмента клиентов. Например, текущий лимит (условно 3-5 тыс. руб. в месяц на повышенный кэшбэк) некоторые активные клиенты, видимо, выбирающие супермаркеты, легко достигают – об этом может свидетельствовать, например, аномально низкий процент возврата в категории “рестораны” у одного пользователя (возможно, из-за исчерпания лимита). Если позволить самым активным клиентам получать кэшбэк сверх стандартных лимитов (например, в рамках премиальных программ), банк может повысить их удержание. Это, конечно, требует дополнительного анализа unit-экономики (стоимости кэшбэка), но с точки зрения продукта такой шаг укрепил бы лояльность ценного сегмента.
•	Подписка Tinkoff PRO и расширение категорий потенциально стимулируют использование карты. Хотя статистически значимого подтверждения нет, подписчики в выборке демонстрировали почти двукратно большую долю “осознанных” трат (в выбранных категориях). Рекомендация: рассмотреть промо-кампании по подключению подписки среди активных клиентов, акцентируя выгоду от большего кэшбэка. Также имеет смысл провести полноценный A/B-тест: например, предложить случайной группе клиентов на время одну дополнительную категорию к их стандартным 7 (аналог подписки) и сравнить их поведение с контролем. Это даст более надёжную оценку эффекта. Если эффект есть (больший оборот или большая доля трат в категориях), то продвижение подписки или расширение функционала категорий окупится увеличением транзакций.
В целом, продуктовая аналитика показала, что программа повышенного кэшбэка Tinkoff Black активно используется и влияет на распределение расходов клиентов. Клиенты адаптируют своё поведение под бонусы – что подтверждается высокой долей трат в выбранных категориях (в среднем ~24% всех расходов, а у самых увлеченных – >50%). Для банка это подтверждение эффективности механики: она стимулирует держателей карт использовать их чаще и в разных сферах. Рекомендации сводятся к тому, чтобы и далее поощрять использование этой функции (обучение новых пользователей, персонализированные категории) и изучать возможности её расширения (например, через подписку или временные акции), удерживая баланс между привлекательностью для клиента и затратами для банка.
Архитектура пайплайна данных
Для реализации проекта разработан конвейер обработки данных от получения сырых данных до построения дашбордов. Ниже описана архитектура решения и используемые компоненты:
1.	Источник данных: исторические выгрузки транзакций и кэшбэка (CSV-файлы) из операционных систем банка. Например, файл tinkoff_black_cashback_apr-sep.csv содержит агрегированные данные по клиентам, используемые в этом проекте. В реальном сценарии источником могли бы быть таблицы боевой БД.
2.	Staging (сырое хранилище): данные загружаются в PostgreSQL в промежуточную таблицу без изменений (cashback_staging). Эта таблица отражает структуру и содержимое исходных CSV. Загрузка автоматизирована скриптом (задача extract_csv), который может запускаться по расписанию (например, при ежемесячном поступлении нового файла).
3.	Очистка и трансформация (Transform): на уровне БД выполняются SQL-скрипты очистки и приведения данных. Скрипт postgres_02_cleaning.sql реализует преобразования: замену кодовых значений на NULL/0/1, расчет вспомогательных полей (например, суммарного оборота клиента за месяц, количества выбранных категорий), нормализацию структуры (перекладка “широкой” таблицы в формат фактов). В результате формируется факт-таблица fact_cashback_category – нормализованные данные по обороту и кэшбэку в разрезе категорий. Дополнительно создаются март-таблицы – агрегированные витрины для аналитики. В нашем случае это mart_client_month (метрики на уровень клиента за месяц) и, возможно, тематические витрины вроде mart_subscription_effect для проверки гипотезы. Эти таблицы денормализованы для удобства запросов в BI.
4.	Обновление витрин и BI: после переработки данных задачи пайплайна обновляют соединение с BI-системой. В Superset настроены дашборды, напрямую подключенные к витринам PostgreSQL. После обновления таблиц в БД графики в дашборде отображают свежие метрики. Основные дашборды включают: динамику MAU и choose rate по месяцам, график среднего оборота и кэшбэка, диаграмму распределения оборотов по категориям, а также отдельный виджет для результатов A/B-гипотезы.
5.	Оркестрация: все шаги объединены с помощью планировщика (например, cron или Airflow). Разработан условный DAG с задачами: (a) загрузка исходных данных в staging, (b) запуск SQL-трансформаций для обновления факт/март таблиц, (c) обновление дашбордов/кешей BI. Данный процесс может запускаться раз в месяц при поступлении новых данных или чаще при необходимости перерасчёта. Настроены уведомления об успехе/ошибках. Кроме того, реализована задача мониторинга качества данных (data_quality), которая проверяет отсутствие пропусков там, где их быть не должно, корректность рассчитанных метрик и т.д., результаты отправляются в канал командной коммуникации. Это позволяет оперативно выявлять проблемы (например, если вдруг в новом месяце список категорий изменился, и скрипт не отработал).
В итоге, выстроенный пайплайн обеспечивает надёжную доставку данных от источника до аналитических витрин с минимальным участием человека. Такая архитектура легко масштабируется – при появлении новых данных или метрик достаточно внести изменения в соответствующие SQL-скрипты и дашборды. Проект продемонстрировал полный цикл продуктовой аналитики: от подготовки данных, их исследования, до получения ценных бизнес-метрик и формулирования предложений по развитию продукта на основе выявленных закономерностей.
________________________________________
[1] [2] [3] T_cashback_Описание_датасета.pdf
file://file_00000000c978722f987edcca1b7e33a4
