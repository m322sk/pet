# Анализ программы кэшбэка Tinkoff Black

## Введение

Тинькофф Black предоставляет клиентам повышенный кэшбэк: каждый месяц можно выбрать несколько категорий покупок, по которым будет повышенный процент возврата средств (обычно **5% против базового 1%**) [1].

В данном проекте проанализированы агрегированные данные по транзакциям и кэшбэку клиентов **Tinkoff Black** за период **апрель – сентябрь 2023 года** [2].

**Цель анализа** — продемонстрировать навыки продуктовой аналитики:
- подготовка и трансформация данных,
- расчёт ключевых продуктовых метрик,
- проверка гипотез о поведении пользователей,
- формулирование бизнес-рекомендаций.

Отчёт структурирован в формате, удобном для размещения в репозитории (README.md). Ниже описаны:
- используемый стек технологий,
- характеристики датасета,
- этапы очистки и трансформации,
- ключевые продуктовые метрики,
- результаты проверки гипотез,
- выводы и рекомендации,
- архитектура пайплайна данных.

---

## Стек технологий

Проект выполнен с использованием следующих инструментов:

- **PostgreSQL**  
  Использовался для хранения данных на этапах staging, формирования факт-таблиц и витрин метрик с помощью SQL. Все исходные данные были загружены в БД и обработаны SQL-скриптами.

- **Python**  
  Применялся для дополнительной обработки данных и аналитических вычислений.  
  Используемые библиотеки:
  - `pandas` — расчёт метрик и подготовка данных,
  - `matplotlib` — визуализация,
  - статистические тесты (двухвыборочный t-test).

- **DBeaver**  
  Клиент для PostgreSQL, использовался для исследования данных, написания и отладки SQL-запросов  
  (например, `postgres_02_cleaning.sql`, `postgres_03_metrics.sql`).

- **BI-платформа (Apache Superset)**  
  Использовалась для визуализации итоговых метрик и построения интерактивных дашбордов.  
  Витрины PostgreSQL напрямую подключены к Superset (MAU, средний чек, распределение оборота и др.).

- **Планировщик (cron / Airflow)**  
  Использовался для оркестрации пайплайна:
  - загрузка данных,
  - запуск SQL-трансформаций,
  - обновление витрин и BI.  
  Реализованы проверки качества данных и алерты (например, через Telegram).

---

## Описание данных

Датасет представляет собой **помесячную агрегированную информацию** по клиентам Tinkoff Black:
- обороты по категориям,
- факты активации повышенного кэшбэка,
- начисленный кэшбэк.

Каждая запись соответствует **уникальному клиенту в конкретном месяце**.

**Период:** апрель – сентябрь 2023  
**Размер выборки:**
- 9 971 уникальный клиент
- ~59,8 тыс. записей формата *клиент–месяц*
- каждый клиент присутствует во всех месяцах

Это позволяет анализировать **динамику поведения одних и тех же пользователей**.

---

## Поля датасета

### Идентификаторы и демография
- `client_id`
- регион, город
- возраст, пол

### Временное измерение
- `month` — календарный месяц (Date)

### Обороты по категориям
- 17 полей вида `turnover_<category>`
- сумма покупок клиента за месяц по категории  
- если покупок не было — `0`  
- если категория не предлагалась — `NULL`

### Активация категорий кэшбэка
- 17 полей `cashback_activation_<category>`
- значения:
  - `1` — категория выбрана
  - `0` — категория предложена, но не выбрана
  - `NULL` — категория не предлагалась

### Начисленный кэшбэк
- 17 полей `cashback_<category>`
- сумма полученного cashback за месяц по категории

---

## Особенности данных

- Клиентам без подписки предлагается выбрать **3 категории из ~7**
- С подпиской **Tinkoff PRO** доступно **8 категорий**
- Прямого признака подписки нет → использована **прокси-переменная**
- Если у клиента в месяце доступно 8 категорий → `has_subscription = 1`
- В выборке всего **3 клиента с подпиской** (ограничение данных)

Данные представлены **в агрегированном виде**, не на уровне транзакций.

---

## Очистка и нормализация данных

### Очистка
- текстовые пропуски → `NULL`
- поля активации → `INTEGER (0/1)`
- обороты и кэшбэк по неактивным категориям → `0`
- проверка на аномалии (отрицательные значения)

### Нормализация
- широкая таблица → длинный формат
- создана факт-таблица:
  - `fact_cashback_category`
- создана агрегированная витрина:
  - `mart_client_month`

### Подписка
- вычислено число доступных категорий
- создан признак `has_subscription`
- пользователи разбиты на control / test

Все трансформации выполнены SQL-скриптами в PostgreSQL.

---

## Основные метрики продукта

### MAU
- MAU стабилен: **9 971** каждый месяц
- отток отсутствует (особенность выборки)

### Средний оборот на клиента
- диапазон: **350–390 тыс. ₽ / месяц**
- пик в июле (~389 тыс. ₽)
- вероятный сезонный эффект

### Средний кэшбэк
- рост с ~3 443 ₽ до ~5 212 ₽
- эффективный процент вырос с **0,98% → 1,43%**
- средний за период: **~1,15%**

### Choose rate
- апрель: **97,1%**
- с мая: **~99%**
- высокая вовлечённость в механику выбора категорий

### Распределение оборота по категориям
Топ-категории:
1. Супермаркеты (~28%)
2. Одежда и обувь (~13%)
3. Рестораны (~10,5%)
4. Дом и ремонт (~9,9%)
5. Фастфуд (~9,7%)

---

## Гипотеза: влияние подписки (8 категорий)

**Гипотеза:**  
Подписчики концентрируют большую долю расходов в выбранных категориях.

**Метод:**
- observational approach
- контроль: 9 968 клиентов
- тест: 3 клиента
- метрика: доля оборота в выбранных категориях
- t-test (Welch)

**Результаты:**
- подписчики: **~52,2%**
- без подписки: **~25,2%**
- uplift: **+107%**
- p-value ≈ 0,13 → статистически незначимо

**Вывод:**  
Эффект выглядит содержательно значимым, но данных недостаточно.

---

## Выводы и рекомендации

- **Высокая вовлечённость (~99%)**  
  → усиливать онбординг и напоминания новым пользователям

- **Концентрация трат в ключевых категориях**  
  → чаще предлагать супермаркеты и FMCG  
  → менее популярные категории персонализировать

- **Высокий средний оборот и кэшбэк**  
  → рассмотреть увеличение лимитов для топ-клиентов

- **Подписка потенциально усиливает вовлечённость**  
  → провести полноценный A/B-тест  
  → протестировать временное расширение категорий

---

## Архитектура пайплайна данных

1. **Источник** — CSV-выгрузки транзакций  
2. **Staging** — `cashback_staging` (PostgreSQL)  
3. **Transform** — SQL-очистка и нормализация  
4. **Март-витрины** — `mart_client_month`, др.  
5. **BI** — Apache Superset  
6. **Оркестрация** — cron / Airflow  
7. **Мониторинг качества данных**

Пайплайн обеспечивает полный цикл продуктовой аналитики:  
от сырых данных до бизнес-инсайтов и рекомендаций.

---

## Источники
[1], [2], [3] — *T_cashback_Описание_датасета.pdf*
