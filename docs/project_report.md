# Анализ программы кэшбэка Tinkoff Black

## Введение

Тинькофф Black предоставляет клиентам повышенный кэшбэк: каждый месяц можно выбрать несколько категорий покупок, по которым будет повышенный процент возврата средств (обычно **5% против базового 1%**).

В данном проекте проанализированы агрегированные данные по транзакциям и кэшбэку клиентов **Tinkoff Black** за период **апрель – сентябрь 2023 года**.

**Цель анализа** — продемонстрировать навыки продуктовой аналитики:
- подготовка и трансформация данных,
- расчёт ключевых продуктовых метрик,
- проверка гипотез о поведении пользователей,
- формулирование бизнес-рекомендаций.

Отчёт структурирован в формате, удобном для размещения в репозитории (README.md). Ниже описаны:
- используемый стек технологий,
- характеристики датасета,
- этапы очистки и трансформации,
- ключевые продуктовые метрики,
- результаты проверки гипотез,
- выводы и рекомендации,
- архитектура пайплайна данных.

---

## Стек технологий

Проект выполнен с использованием следующих инструментов:

- **PostgreSQL**  
  Использовался для хранения данных на этапах staging, формирования факт-таблиц и витрин метрик с помощью SQL. Все исходные данные были загружены в БД и обработаны SQL-скриптами.

- **Python**  
  Применялся для дополнительной обработки данных и аналитических вычислений.  
  Используемые библиотеки:
  - `pandas` — расчёт метрик и подготовка данных,
  - статистические тесты (двухвыборочный t-test).

- **DBeaver**  
  Клиент для PostgreSQL, использовался для исследования данных, написания и отладки SQL-запросов  
  (например, `postgres_02_cleaning.sql`, `postgres_03_metrics.sql`).

- **BI-платформа (Yandex Datalens)**  
  Использовалась для визуализации итоговых метрик и построения интерактивных дашбордов.  
  Витрины PostgreSQL напрямую подключены к Datalens (MAU, средний чек, распределение оборота и др.).
---

## Описание данных

Датасет представляет собой **помесячную агрегированную информацию** по клиентам Tinkoff Black:
- обороты по категориям,
- факты активации повышенного кэшбэка,
- начисленный кэшбэк.

Каждая запись соответствует **уникальному клиенту в конкретном месяце**.

**Период:** апрель – сентябрь 2023  
**Размер выборки:**
- 9 971 уникальный клиент
- ~59,8 тыс. записей формата *клиент–месяц*
- каждый клиент присутствует во всех месяцах

Это позволяет анализировать **динамику поведения одних и тех же пользователей**.

---

## Поля датасета

### Идентификаторы и демография
- `client_id`
- регион, город
- возраст, пол

### Временное измерение
- `month` — календарный месяц (Date)

### Обороты по категориям
- 17 полей вида `turnover_<category>`
- сумма покупок клиента за месяц по категории  
- если покупок не было — `0`  
- если категория не предлагалась — `NULL`

### Активация категорий кэшбэка
- 17 полей `cashback_activation_<category>`
- значения:
  - `1` — категория выбрана
  - `0` — категория предложена, но не выбрана
  - `NULL` — категория не предлагалась

### Начисленный кэшбэк
- 17 полей `cashback_<category>`
- сумма полученного cashback за месяц по категории

---

## Особенности данных

- Клиентам без подписки предлагается выбрать **3 категории из ~7**
- С подпиской **Tinkoff PRO** доступно **8 категорий**
- Прямого признака подписки нет → использована **прокси-переменная**
- Если у клиента в месяце доступно 8 категорий → `has_subscription = 1`
- В выборке всего **3 клиента с подпиской** (ограничение данных)

Данные представлены **в агрегированном виде**, не на уровне транзакций.

---

## Очистка и нормализация данных

### Очистка
- текстовые пропуски → `NULL`
- поля активации → `INTEGER (0/1)`
- обороты и кэшбэк по неактивным категориям → `0`
- проверка на аномалии (отрицательные значения)

### Нормализация
- широкая таблица → длинный формат
- создана факт-таблица:
  - `fact_cashback_category`
- создана агрегированная витрина:
  - `mart_client_month`

### Подписка
- вычислено число доступных категорий
- создан признак `has_subscription`
- пользователи разбиты на control / test

Все трансформации выполнены SQL-скриптами в PostgreSQL.

---

## Основные метрики продукта

### MAU
- MAU стабилен: **9 971** каждый месяц
- отток отсутствует (особенность выборки)

### Средний оборот на клиента
- диапазон: **350–390 тыс. ₽ / месяц**
- пик в июле (~389 тыс. ₽)
- вероятный сезонный эффект

### Средний кэшбэк
- рост с ~3 443 ₽ до ~5 212 ₽
- эффективный процент вырос с **0,98% → 1,43%**
- средний за период: **~1,15%**

### Choose rate
- апрель: **97,1%**
- с мая: **~99%**
- высокая вовлечённость в механику выбора категорий

### Распределение оборота по категориям
Топ-категории:
1. Супермаркеты (~28%)
2. Одежда и обувь (~13%)
3. Рестораны (~10,5%)
4. Дом и ремонт (~9,9%)
5. Фастфуд (~9,7%)

---

## Гипотеза: влияние подписки (8 категорий)

**Формулировка гипотезы:** Пользователи, которым доступно 8 категорий для выбора (то есть с подпиской Tinkoff PRO), демонстрируют иную структуру расходов по сравнению с остальными. В частности, предполагалось, что наличие расширенного набора категорий приводит к тому, что большая доля расходов этих пользователей приходится на выбранные ими категории (т.к. они либо могут выбрать больше категорий одновременно, либо имеют более подходящие варианты под свои траты). Иными словами, подписчики активнее оптимизируют свои расходы под повышенный кэшбэк.

**Метод проверки:** В силу ограничений данных, прямой A/B-тест невозможен – мы не имеем случайно разделённых групп, а лишь наблюдаем существующие различия (observational approach). Поэтому мы разделили исторические данные на две группы:

- **Control:** пользователи без подписки (в нашем датасете – те, у кого никогда не было 8 доступных категорий в месяце). Таких – 9 968 человек.
- **Test:** пользователи с признаками подписки (те, у кого хотя бы в одном месяце было 8 категорий на выбор). Таких нашлось всего 3 человека в апреле 2023. (Примечание: малый размер группы – ограничение выборки; в реальности доля подписчиков могла быть больше.)

В качестве целевой метрики взяли долю оборота в выбранных категориях для каждого клиента. Для каждого пользователя рассчитана величина: сумма его расходов по тем категориям, которые он выбрал для повышенного кэшбэка, делённая на общий оборот пользователя. Чем выше эта доля, тем больше клиент концентрирует траты в “выбранных” категориях (то есть максимизирует возврат). Мы сравнили средние значения этой метрики между двумя группами за весь период. Статистическая проверка выполнена с помощью двухвыборочного t-теста (Welch’s t-test) для независимых групп, несмотря на весьма неравные размеры выборок.

**Результаты:** Пользователи с подпиской действительно показывают большую долю расходов в выбранных категориях: около 52,2% их трат приходится на категории с повышенным кэшбэком, в то время как у пользователей без подписки – лишь ~25,2%. Иначе говоря, в нашей выборке “подписчики” направляли на выбранные категории примерно половину своих средств, тогда как остальные – только четверть. Разница (uplift) составляет порядка +107% относительно контрольной группы. Однако, статистический тест не подтвердил значимость этого отличия на обычном уровне уверенности 95%. Расчётный критерий t = 1,53 при приблизительно 2 степенях свободы (из-за крайне малого размера test-группы) даёт p-value ~0,13, что выше порога 0,05. Таким образом, мы не отвергаем нулевую гипотезу о равенстве средних – формально влияние подписки на долю оборота в выбранных категориях не доказано.

Тем не менее, практически столь большая разница выглядит содержательно важной. Скорее всего, причина статистической незначимости – недостаток данных о подписчиках: всего 3 наблюдения явно недостаточно для выявления эффекта. Можно сделать осторожный вывод, что пользователи с подпиской действительно стараются извлечь больше выгоды: имея больше категорий на выбор (и, возможно, возможность выбрать больше категорий одновременно), они охватывают повышенным кэшбэком больший процент своих расходов. Косвенно это подтверждается тем, что один из подписчиков из выборки сумел получить повышенный кэшбэк почти со всей суммы трат (его показатель ~85%). Также нельзя исключить эффект самоселекции: подписку оформляют, вероятно, самые лояльные и финансово активные клиенты, которые изначально склонны оптимизировать расходы. Таким образом, выявленный uplift в ~27 процентных пунктов (52% vs 25%) в доле “осмысленных” трат – ценное наблюдение, но для уверенности необходимы дополнительные данные или эксперимент.

**Вывод по гипотезе:** хотя статистически значимых доказательств нет, данные указывают на то, что расширение числа категорий (продуктовое преимущество подписки) связано с более высоким вовлечением в использование карточных бонусов. Это потенциально ценно для бизнеса: подписчики могут генерировать больший оборот по картам в тех категориях, где банк предоставляет кэшбэк, что может означать более частое использование карты и рост транзакционной активности.


---

## Выводы и рекомендации

- **Высокая вовлечённость (~99%)**  
  → усиливать онбординг и напоминания новым пользователям

- **Концентрация трат в ключевых категориях**  
  → чаще предлагать супермаркеты и FMCG  
  → менее популярные категории персонализировать

- **Высокий средний оборот и кэшбэк**  
  → рассмотреть увеличение лимитов для топ-клиентов

- **Подписка потенциально усиливает вовлечённость**  
  → провести полноценный A/B-тест  
  → протестировать временное расширение категорий

---

## Архитектура пайплайна данных

1. **Источник** — CSV-выгрузки транзакций  
2. **Staging** — `cashback_staging` (PostgreSQL)  
3. **Transform** — SQL-очистка и нормализация  
4. **Март-витрины** — `mart_client_month`, др.  
5. **BI** — Yandex Datalens

Пайплайн обеспечивает полный цикл продуктовой аналитики:  
от сырых данных до бизнес-инсайтов и рекомендаций.

